<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test de fatigue</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ============================================================
   BASE
============================================================ */
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 0;
}

.page {
  display: none;
  background: white;
  padding: 40px 30px;
  max-width: 1200px;
  width: 90%;
  margin: 20px auto;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  animation: fadeIn 0.4s ease;
}

.page.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

.header-logos {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.header-logos img { height: 60px; }

/* ============================================================
   BOUTON FLOTTANT (fixé, sans saut)
============================================================ */
.start-test-container {
  position: fixed;
  right: 30px;
  bottom: 30px;
  z-index: 1000;
}

.start-button {
  font-size: 20px;
  padding: 14px 32px;
  background-color: #d32f2f;
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

.start-button:hover { background-color: #b71c1c; }
.start-button:disabled { background:#aaa; cursor:not-allowed; }

/* ============================================================
   PAGE QUESTIONS
============================================================ */
#questionText { font-size: 26px; margin-bottom: 15px; white-space: pre-line; }

#questionImage {
  display:none;
  max-width:100%;
  margin-bottom:20px;
  border-radius:8px;
}

.progress-bar {
  height:8px;
  background:#ddd;
  border-radius:5px;
  overflow:hidden;
}

#progressFill {
  height:100%;
  width:0%;
  background:#1976d2;
  transition:width .3s;
}

.answer-row {
  display:flex;
  gap:10px;
}

textarea {
  flex:1;
  height:80px;
  font-size:16px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

.arrow-button {
  width:50px;
  height:50px;
  font-size:22px;
  border-radius:50%;
  border:none;
  background:#1976d2;
  color:white;
}

/* ============================================================
   QCM
============================================================ */
.qcm-container { display:none; flex-direction:column; gap:12px; }

.qcm-choice {
  padding:14px;
  border-radius:10px;
  border:2px solid #ddd;
  cursor:pointer;
}

.qcm-choice.selected {
  background:#1976d2;
  color:white;
  border-color:#1976d2;
}

/* ============================================================
   PAGE DETAILS
============================================================ */
.details-nav {
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:25px;
}

.details-nav button {
  width:40px;
  height:40px;
  border-radius:50%;
  border:none;
  font-weight:bold;
  background:#bdbdbd;
  cursor:pointer;
  transition:transform .15s;
}

.details-nav button.correct { background:#2e7d32; color:white; }
.details-nav button.partial { background:#f57c00; color:white; }
.details-nav button.wrong   { background:#c62828; color:white; }

.details-nav button.active {
  background:#1565c0 !important;
  color:white !important;
  box-shadow:0 0 0 3px rgba(21,101,192,.35);
}

.details-nav button:hover { transform:scale(1.1); }

.details-content {
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:30px;
}

.details-column {
  background:#f9f9f9;
  padding:20px;
  border-radius:12px;
}

.details-status {
  padding:10px;
  border-radius:8px;
  text-align:center;
  font-weight:bold;
}

.details-status.correct { background:#e8f5e9; color:#2e7d32; }
.details-status.partial { background:#fff8e1; color:#f57c00; }
.details-status.wrong   { background:#fdecea; color:#c62828; }
</style>
</head>

<body>

<!-- ============================================================
   PAGES
============================================================ -->

<div id="home" class="page active">
  <div class="header-logos">
    <img src="{{ url_for('static', filename='logo-crossing.png') }}">
    <img src="{{ url_for('static', filename='logo-UT.png') }}">
  </div>

  <h1>Votre espace</h1>
  <p>Historique personnel</p>

  <div class="start-test-container" id="floatingStartBtn">
    <button class="start-button" onclick="startTest()">Commencer un nouveau test</button>
  </div>
</div>

<div id="questionPage" class="page">
  <span id="questionCounter"></span>
  <div class="progress-bar"><div id="progressFill"></div></div>

  <img id="questionImage">
  <h2 id="questionText"></h2>

  <div id="openAnswerZone" class="answer-row">
    <textarea id="input"></textarea>
    <button id="openArrowButton" class="arrow-button" disabled onclick="nextQuestion()">➜</button>
  </div>

  <div id="qcmZone" class="qcm-container"></div>
</div>

<div id="review" class="page">
  <h2>Résultats</h2>
  <button class="start-button" onclick="showDetails()">Voir détails</button>
</div>

<div id="details" class="page">
  <h2>Détails par question</h2>

  <div class="details-nav" id="detailsNav"></div>

  <div class="details-content">
    <div class="details-column">
      <h3>Question</h3>
      <div id="detailsQuestionIndex"></div>
      <p id="detailsQuestion"></p>
      <img id="detailsImage" style="display:none;width:100%;border-radius:10px;">
      <p id="detailsDescription"></p>
    </div>

    <div class="details-column">
      <h3>Votre réponse</h3>
      <p id="detailsAnswer"></p>
    </div>

    <div class="details-column">
      <h3>Résultat</h3>
      <div id="detailsStatus" class="details-status"></div>
      <canvas id="detailsChart"></canvas>
    </div>
  </div>
</div>

<script>
/* ============================================================
   LOGIQUE SIMPLIFIÉE (LLM results déjà reçus)
============================================================ */
const results = [
  { question:"Q1", answer:"A", result:"correct", score:8 },
  { question:"Q2", answer:"B", result:"wrong", score:3 },
  { question:"Q3", answer:"C", result:"partial", score:5 }
];

function showPage(id) {
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function startTest(){ alert("Branché backend LLM"); }

function showDetails(){
  buildDetailsNav();
  showDetail(0);
  showPage("details");
}

function buildDetailsNav(){
  const nav=document.getElementById("detailsNav");
  nav.innerHTML="";
  results.forEach((r,i)=>{
    const b=document.createElement("button");
    b.textContent=i+1;
    b.classList.add(r.result);
    b.onclick=()=>showDetail(i);
    nav.appendChild(b);
  });
}

let chart=null;

function showDetail(i){
  const r=results[i];
  document.querySelectorAll(".details-nav button").forEach((b,idx)=>{
    b.classList.toggle("active",idx===i);
  });

  document.getElementById("detailsQuestionIndex").textContent=`Question ${i+1} / ${results.length}`;
  document.getElementById("detailsQuestion").textContent=r.question;
  document.getElementById("detailsAnswer").textContent=r.answer;

  const st=document.getElementById("detailsStatus");
  st.className=`details-status ${r.result}`;
  st.textContent=r.result.toUpperCase();

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("detailsChart"),{
    type:"doughnut",
    data:{ labels:["Score","Reste"], datasets:[{ data:[r.score,10-r.score] }]},
    options:{ responsive:true, maintainAspectRatio:false }
  });
}
</script>

</body>
</html>
